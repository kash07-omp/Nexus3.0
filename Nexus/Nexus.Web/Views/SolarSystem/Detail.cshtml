@model Nexus.Web.Models.SolarSystemViewModel

<div class="container">
    <h2>Detalle del sistema solar: @Model.SolarSystem.Name</h2>

    <div id="solarSystemGrid">
        @for (int y = 1; y <= Model.SolarSystem.GridSizeY; y++)
        {
            @for (int x = 1; x <= Model.SolarSystem.GridSizeX; x++)
            {
                var cellClass = "solar-system-cell";
                var dataItemId = "";
                var cellContent = new List<string>();

                // Estrella en el centro del sistema solar
                if (x == Model.SolarSystem.GridSizeX / 2 + 1 && y == Model.SolarSystem.GridSizeY / 2 + 1)
                {
                    cellClass += " estrella";
                    cellContent.Add("Estrella");
                }
                else
                {
                    // Planetas, campos de asteroides, puertas de salto y flotas
                    var planet = Model.SolarSystem.Planets.FirstOrDefault(p => p.CoordinateX == x && p.CoordinateY == y);
                    var asteroid = Model.SolarSystem.AsteroidFields.FirstOrDefault(a => a.CoordinateX == x && a.CoordinateY == y);
                    var jumpGate = Model.SolarSystem.JumpGates.FirstOrDefault(j => j.CoordinateX == x && j.CoordinateY == y);
                    var fleets = Model.SolarSystem.Fleets.Where(f => f.CoordinateX == x && f.CoordinateY == y).ToList();

                    if (planet != null)
                    {
                        cellClass += " planet";
                        cellContent.Add("Planeta");
                        dataItemId = planet.Id.ToString();

                        // Si el planeta pertenece al usuario actual
                        var userPlanet = planet.Regions.FirstOrDefault(r => r.UserId == Model.CurrentUser.Id);
                        if (userPlanet != null)
                            cellClass += " planet-own";
                    }
                    else if (asteroid != null)
                    {
                        cellClass += " asteroidfield";
                        cellContent.Add("Campo de asteroides");
                        dataItemId = asteroid.Id.ToString();
                    }
                    else if (jumpGate != null)
                    {
                        cellClass += " jumppoint";
                        cellContent.Add("Puerta de salto");
                        dataItemId = jumpGate.Id.ToString();
                    }

                    // Mostrar todas las flotas en la celda
                    foreach (var fleet in fleets)
                    {
                        var fleetClass = fleet.UserId == Model.CurrentUser.Id ? " fleet-own" : " fleet-enemy";
                        var fleetName = fleet.Name;
                        cellContent.Add($"<span class='{fleetClass}' data-item-id='{fleet.Id}'>{fleetName}</span>");
                    }
                }

                <div class="@cellClass" data-item-id="@dataItemId" data-item-x="@x" data-item-y="@y">
                    @Html.Raw(string.Join("<br/>", cellContent))
                </div>
            }
        }
    </div>
</div>

@section Styles {
    <style>
        /* Configuración general del fondo */
        body { background-image: url('https://i.pinimg.com/originals/1a/ba/73/1aba73d7d0cf7299158082fab3d8bfa3.jpg'); background-size: cover; background-attachment: fixed; margin: 0; padding: 0; color: white; }

        /* Estilos del contenedor del sistema solar */
        #solarSystemGrid { display: grid; grid-template-columns: repeat(@Model.SolarSystem.GridSizeX, 1fr); grid-template-rows: repeat(@Model.SolarSystem.GridSizeY, 1fr); }

        /* Estilos de las celdas del grid */
        .solar-system-cell { height: 75px; border: 1px solid #ffffff80; display: flex; justify-content: center; align-items: center; background-color: rgba(0, 0, 0, 0.5); text-align: center; color: white; flex-direction: column; }

            /* Estilo para planetas */
            .solar-system-cell.planet { background-color: rgba(0, 123, 255, 0.3); }

            /* Estilo especial para planetas del usuario */
            .solar-system-cell.planet-own { color: green; font-weight: bold; }

            /* Estilo para campos de asteroides */
            .solar-system-cell.asteroidfield { background-color: rgba(128, 128, 128, 0.3); }

            /* Estilo para puertas de salto */
            .solar-system-cell.jumppoint { background-color: rgba(255, 165, 0, 0.3); }

            /* Estilo especial para la estrella */
            .solar-system-cell.estrella { background-color: rgba(255, 255, 0, 0.3); }

        /* Estilos para flotas */
        .fleet-own { color: green; }
        .fleet-enemy { color: red; }
    </style>
}
